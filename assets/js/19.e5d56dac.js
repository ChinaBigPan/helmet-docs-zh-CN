(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{364:function(t,e,n){"use strict";n.r(e);var s=n(41),a=Object(s.a)({},(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"停止嗅探mime-type"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#停止嗅探mime-type","aria-hidden":"true"}},[t._v("#")]),t._v(" 停止嗅探MIME Type "),n("Badge",{attrs:{text:"默认启用"}})],1),t._v(" "),n("p",[n("a",{attrs:{href:"https://helmetjs.github.io/docs/dont-sniff-mimetype/",target:"_blank",rel:"noopener noreferrer"}},[t._v("原文链接"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("简介："),n("code",[t._v("noSniff")]),t._v("中间件阻止浏览器猜测（嗅探）MIME Type，以排除安全隐患。它的工作原理是将"),n("code",[t._v("X-Content-Type-Options")]),t._v("报头设置为"),n("code",[t._v("nosniff")]),t._v("。")]),t._v(" "),n("h2",{attrs:{id:"攻击方式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#攻击方式","aria-hidden":"true"}},[t._v("#")]),t._v(" 攻击方式")]),t._v(" "),n("p",[t._v("MIME Type 用于确定您正在查看的文件类型的方法。PNG图像是"),n("code",[t._v("image/png")]),t._v("; JSON文件是"),n("code",[t._v("application/json")]),t._v(";JavaScript文件是"),n("code",[t._v("text/javascript")]),t._v("。当浏览器加载文件时。它通过读取服务端的"),n("code",[t._v("Content-Type")]),t._v("报头来决定文件的类型。")]),t._v(" "),n("p",[t._v("当你的浏览器看到下面这段代码时：")]),t._v(" "),n("div",{staticClass:"language-html line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("https://example.com/my-javascript"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),n("span",{pre:!0,attrs:{class:"token script"}}),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("p",[t._v("它会从"),n("code",[t._v("example.com")]),t._v("加载"),n("code",[t._v("my-javascript")]),t._v("。如果"),n("code",[t._v("example.com")]),t._v("带有了值为"),n("code",[t._v("text/javascript")]),t._v("的"),n("code",[t._v("Content-Type")]),t._v("报头，那么你的浏览器会按照JavaScript来执行"),n("code",[t._v("my-javascript")]),t._v("的内容。")]),t._v(" "),n("p",[t._v("那么如果设置"),n("code",[t._v("Content-Type: text/heml")]),t._v("会怎么样？如果您的浏览器执行了所谓的“MIME Type 嗅探”策略(有些人是这么做的)，它将查看文件的内容，判断它是否是JavaScript，如果是，则执行它。这意味着服务器可以发送错误的"),n("code",[t._v("Content-Type")]),t._v("，但JavaScript仍然可以执行。")]),t._v(" "),n("p",[t._v("那么MIME Type嗅探就成了一个攻击维度。用户可以上传扩展名为.jpg的图片，但其实际内容是HTML。查看该图像可能导致浏览器“运行”HTML页面，这可能会包含恶意的JavaScirpt代码。最糟糕的要数"),n("a",{attrs:{href:"https://miki.it/blog/2014/7/8/abusing-jsonp-with-rosetta-flash/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Rosetta Flash"),n("OutboundLink")],1),t._v("攻击了，它是让您的页面加载恶意Flash插件而不是数据。")]),t._v(" "),n("p",[t._v("扩展阅读：")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://en.wikipedia.org/wiki/Media_type",target:"_blank",rel:"noopener noreferrer"}},[t._v("“MIME type” on Wikipedia"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://blog.fox-it.com/2012/05/08/mime-sniffing-feature-or-vulnerability/",target:"_blank",rel:"noopener noreferrer"}},[t._v("“MIME Sniffing: feature or vulnerability?”"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"http://www.h-online.com/security/features/Risky-MIME-sniffing-in-Internet-Explorer-746229.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("“MIME sniffing in Internet Explorer enables cross-site scripting attacks”"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://blog.miki.it/2014/7/8/abusing-jsonp-with-rosetta-flash/",target:"_blank",rel:"noopener noreferrer"}},[t._v("“Abusing JSONP with Rosetta Flash”"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://mimesniff.spec.whatwg.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("MIME Sniffing live standard"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://developers.google.com/web/updates/2018/07/site-isolation",target:"_blank",rel:"noopener noreferrer"}},[t._v("Cross Origin Resource Blocking in Chrome"),n("OutboundLink")],1)])]),t._v(" "),n("h2",{attrs:{id:"报头详解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#报头详解","aria-hidden":"true"}},[t._v("#")]),t._v(" 报头详解")]),t._v(" "),n("p",[n("code",[t._v("X-Content-Type-Options")]),t._v("报头告诉浏览器是否嗅探MIME Types。当其被设置为"),n("code",[t._v("nosniff")]),t._v("时，浏览器将不会进行嗅探——它们会相信服务器所说并在资源出错时进行阻止。")]),t._v(" "),n("p",[t._v("扩展阅读:")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Content-Type-Options",target:"_blank",rel:"noopener noreferrer"}},[t._v("“X-Content-Type-Options” on MDN"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://stackoverflow.com/questions/18337630/",target:"_blank",rel:"noopener noreferrer"}},[t._v("“What is ‘X-Content-Type-Options=nosniff’?” on Stack Overflow"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://msdn.microsoft.com/en-us/library/gg622941(v=vs.85).aspx",target:"_blank",rel:"noopener noreferrer"}},[t._v("“Reducing MIME type security risks” on MSDN"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://blogs.msdn.microsoft.com/ie/2008/07/02/ie8-security-part-v-comprehensive-protection/",target:"_blank",rel:"noopener noreferrer"}},[t._v("“IE8 Security Part V: Comprehensive Protection” on MSDN"),n("OutboundLink")],1)])]),t._v(" "),n("h2",{attrs:{id:"代码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#代码","aria-hidden":"true"}},[t._v("#")]),t._v(" 代码")]),t._v(" "),n("p",[n("code",[t._v("noSniff")]),t._v("中间件将把每个请求的"),n("code",[t._v("X-Content-Type-Options")]),t._v("报头的值设置为"),n("code",[t._v("nosniff")]),t._v("。")]),t._v(" "),n("p",[t._v("您可以作为Helmet的内部模块来使用：")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// Make sure you run "npm install helmet" to get the Helmet package.')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" helmet "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'helmet'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// Sets "X-Content-Type-Options: nosniff".')]),t._v("\napp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("helmet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("noSniff")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br")])]),n("p",[t._v("也可单独使用：")]),t._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// Make sure you run "npm install dont-sniff-mimetype" to get this package.')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" noSniff "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dont-sniff-mimetype'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// Sets "X-Content-Type-Options: nosniff".')]),t._v("\napp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("noSniff")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br")])])])}),[],!1,null,null,null);e.default=a.exports}}]);